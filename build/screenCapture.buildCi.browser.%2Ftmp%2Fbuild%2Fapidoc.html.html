<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/npm/lockfile#readme">lockfile (v1.0.3)</a>
</h1>
<h4>A very polite lock file utility, which endeavors to not litter, and to wait patiently for others.</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.lockfile">module lockfile</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.lockfile.check">
            function <span class="apidocSignatureSpan">lockfile.</span>check
            <span class="apidocSignatureSpan">(path, opts, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.lockfile.checkSync">
            function <span class="apidocSignatureSpan">lockfile.</span>checkSync
            <span class="apidocSignatureSpan">(path, opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.lockfile.lock">
            function <span class="apidocSignatureSpan">lockfile.</span>lock
            <span class="apidocSignatureSpan">(path, opts, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.lockfile.lockSync">
            function <span class="apidocSignatureSpan">lockfile.</span>lockSync
            <span class="apidocSignatureSpan">(path, opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.lockfile.unlock">
            function <span class="apidocSignatureSpan">lockfile.</span>unlock
            <span class="apidocSignatureSpan">(path, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.lockfile.unlockSync">
            function <span class="apidocSignatureSpan">lockfile.</span>unlockSync
            <span class="apidocSignatureSpan">(path)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">lockfile.</span>filetime</span>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.lockfile" id="apidoc.module.lockfile">module lockfile</a></h1>


    <h2>
        <a href="#apidoc.element.lockfile.check" id="apidoc.element.lockfile.check">
        function <span class="apidocSignatureSpan">lockfile.</span>check
        <span class="apidocSignatureSpan">(path, opts, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">check = function (path, opts, cb) {
  if (typeof opts === 'function') cb = opts, opts = {}
  debug('check', path, opts)
  fs.open(path, 'r', function (er, fd) {
    if (er) {
      if (er.code !== 'ENOENT') return cb(er)
      return cb(null, false)
    }

    if (!opts.stale) {
      return fs.close(fd, function (er) {
        return cb(er, true)
      })
    }

    fs.fstat(fd, function (er, st) {
      if (er) return fs.close(fd, function (er2) {
        return cb(er)
      })

      fs.close(fd, function (er) {
        var age = Date.now() - st[exports.filetime].getTime()
        return cb(er, age &lt;= opts.stale)
      })
    })
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Close and unlink the lockfile.

### lockFile.unlockSync(path)

Close and unlink the lockfile.

### lockFile.<span class="apidocCodeKeywordSpan">check</span>(path, [opts], cb)

Check if the lockfile is locked and not stale.

Callback is called with `cb(error, isLocked)`.

### lockFile.checkSync(path, [opts])
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.lockfile.checkSync" id="apidoc.element.lockfile.checkSync">
        function <span class="apidocSignatureSpan">lockfile.</span>checkSync
        <span class="apidocSignatureSpan">(path, opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">checkSync = function (path, opts) {
  opts = opts || {}
  debug('checkSync', path, opts)
  if (opts.wait) {
    throw new Error('opts.wait not supported sync for obvious reasons')
  }

  try {
    var fd = fs.openSync(path, 'r')
  } catch (er) {
    if (er.code !== 'ENOENT') throw er
    return false
  }

  if (!opts.stale) {
    try { fs.closeSync(fd) } catch (er) {}
    return true
  }

  // file exists.  however, might be stale
  if (opts.stale) {
    try {
      var st = fs.fstatSync(fd)
    } finally {
      fs.closeSync(fd)
    }
    var age = Date.now() - st[exports.filetime].getTime()
    return (age &lt;= opts.stale)
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

### lockFile.check(path, [opts], cb)

Check if the lockfile is locked and not stale.

Callback is called with `cb(error, isLocked)`.

### lockFile.<span class="apidocCodeKeywordSpan">checkSync</span>(path, [opts])

Check if the lockfile is locked and not stale.

Returns boolean.

## Options
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.lockfile.lock" id="apidoc.element.lockfile.lock">
        function <span class="apidocSignatureSpan">lockfile.</span>lock
        <span class="apidocSignatureSpan">(path, opts, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">lock = function (path, opts, cb) {
  if (typeof opts === 'function') cb = opts, opts = {}
  opts.req = opts.req || req++
  debug('lock', path, opts)
  opts.start = opts.start || Date.now()

  if (typeof opts.retries === 'number' &amp;&amp; opts.retries &gt; 0) {
    debug('has retries', opts.retries)
    var retries = opts.retries
    opts.retries = 0
    cb = (function (orig) { return function cb (er, fd) {
      debug('retry-mutated callback')
      retries -= 1
      if (!er || retries &lt; 0) return orig(er, fd)

      debug('lock retry', path, opts)

      if (opts.retryWait) setTimeout(retry, opts.retryWait)
      else retry()

      function retry () {
        opts.start = Date.now()
        debug('retrying', opts.start)
        exports.lock(path, opts, cb)
      }
    }})(cb)
  }

  // try to engage the lock.
  // if this succeeds, then we're in business.
  fs.open(path, wx, function (er, fd) {
    if (!er) {
      debug('locked', path, fd)
      locks[path] = fd
      return fs.close(fd, function () {
        return cb()
      })
    }

    // something other than "currently locked"
    // maybe eperm or something.
    if (er.code !== 'EEXIST') return cb(er)

    // someone's got this one.  see if it's valid.
    if (!opts.stale) return notStale(er, path, opts, cb)

    return maybeStale(er, path, opts, false, cb)
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    if (opts.retryWait) setTimeout(retry, opts.retryWait)
    else retry()

    function retry () {
      opts.start = Date.now()
      debug('retrying', opts.start)
      exports.<span class="apidocCodeKeywordSpan">lock</span>(path, opts, cb)
    }
  }})(cb)
}

// try to engage the lock.
// if this succeeds, then we're in business.
fs.open(path, wx, function (er, fd) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.lockfile.lockSync" id="apidoc.element.lockfile.lockSync">
        function <span class="apidocSignatureSpan">lockfile.</span>lockSync
        <span class="apidocSignatureSpan">(path, opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">lockSync = function (path, opts) {
  opts = opts || {}
  opts.req = opts.req || req++
  debug('lockSync', path, opts)
  if (opts.wait || opts.retryWait) {
    throw new Error('opts.wait not supported sync for obvious reasons')
  }

  try {
    var fd = fs.openSync(path, wx)
    locks[path] = fd
    try { fs.closeSync(fd) } catch (er) {}
    debug('locked sync!', path, fd)
    return
  } catch (er) {
    if (er.code !== 'EEXIST') return retryThrow(path, opts, er)

    if (opts.stale) {
      var st = fs.statSync(path)
      var ct = st[exports.filetime].getTime()
      if (!(ct % 1000) &amp;&amp; (opts.stale % 1000)) {
        // probably don't have subsecond resolution.
        // round up the staleness indicator.
        // Yes, this will be wrong 1/1000 times on platforms
        // with subsecond stat precision, but that's acceptable
        // in exchange for not mistakenly removing locks on
        // most other systems.
        opts.stale = 1000 * Math.ceil(opts.stale / 1000)
      }
      var age = Date.now() - ct
      if (age &gt; opts.stale) {
        debug('lockSync stale', path, opts, age)
        exports.unlockSync(path)
        return exports.lockSync(path, opts)
      }
    }

    // failed to lock!
    debug('failed to lock', path, opts, er)
    return retryThrow(path, opts, er)
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      // most other systems.
      opts.stale = 1000 * Math.ceil(opts.stale / 1000)
    }
    var age = Date.now() - ct
    if (age &gt; opts.stale) {
      debug('lockSync stale', path, opts, age)
      exports.unlockSync(path)
      return exports.<span class="apidocCodeKeywordSpan">lockSync</span>(path, opts)
    }
  }

  // failed to lock!
  debug('failed to lock', path, opts, er)
  return retryThrow(path, opts, er)
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.lockfile.unlock" id="apidoc.element.lockfile.unlock">
        function <span class="apidocSignatureSpan">lockfile.</span>unlock
        <span class="apidocSignatureSpan">(path, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unlock = function (path, cb) {
  debug('unlock', path)
  // best-effort.  unlocking an already-unlocked lock is a noop
  delete locks[path]
  fs.unlink(path, function (unlinkEr) { cb &amp;&amp; cb() })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}

var age = Date.now() - st[exports.filetime].getTime()
if (age &lt;= opts.stale) return notStale(originalEr, path, opts, cb)

debug('lock stale', path, opts)
if (hasStaleLock) {
  exports.<span class="apidocCodeKeywordSpan">unlock</span>(path, function (er) {
    if (er) return cb(er)
    debug('lock stale retry', path, opts)
    fs.link(path + '.STALE', path, function (er) {
      fs.unlink(path + '.STALE', function () {
        // best effort.  if the unlink fails, oh well.
        cb(er)
      })
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.lockfile.unlockSync" id="apidoc.element.lockfile.unlockSync">
        function <span class="apidocSignatureSpan">lockfile.</span>unlockSync
        <span class="apidocSignatureSpan">(path)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unlockSync = function (path) {
  debug('unlockSync', path)
  // best-effort.  unlocking an already-unlocked lock is a noop
  try { fs.unlinkSync(path) } catch (er) {}
  delete locks[path]
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    // in exchange for not mistakenly removing locks on
    // most other systems.
    opts.stale = 1000 * Math.ceil(opts.stale / 1000)
  }
  var age = Date.now() - ct
  if (age &gt; opts.stale) {
    debug('lockSync stale', path, opts, age)
    exports.<span class="apidocCodeKeywordSpan">unlockSync</span>(path)
    return exports.lockSync(path, opts)
  }
}

// failed to lock!
debug('failed to lock', path, opts, er)
return retryThrow(path, opts, er)
...</pre></li>
    </ul>




</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>